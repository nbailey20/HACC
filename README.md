# Homemade Authentication Credential Client - HACC

HACC is an open-source credential manager command-line tool that uses your personal AWS account to securely store your secrets, so you don't have to wonder who's secretly selling your data behind the scenes!

* Built in Python3 with Rich command-line output
* Credentials securely stored in your own AWS-hosted "Vault" (SSM Parameter Store)
* Credentials are organized by "service", i.e. gmail, amazon.com, github, etc
* Encrypted with AWS KMS Customer-Managed Key so only you can decrypt

## v0.9.0

##### Table of Contents  
- [Installation](#installation)
  - [Prerequisites](#prerequisites)
  - [Brand-New Installation](#brand-new-installation)
  - [Adding New Device to Existing Vault](#adding-new-device-to-existing-vault)
- [Example Usage & Features](#example-usage--features)
  - [Verifying Client Installation](#verifying-client-installation)
  - [Adding Credentials](#adding-credentials)
  - [Searching Credentials](#searching-credentials)



# Installation

## Prerequisites
### Required Python3 libraries
* boto3
* rich
* packaging (for managing client versions/upgrades)

### Required AWS IAM Permissions
HACC will create an IAM user dedicated for credential management, however the client needs some AWS permissions to administrate the Vault. HACC will attempt to use whichever user is currently logged into AWS CLI when performing install/eradicate actions. If you want to create a dedicated Vault admin user for the client, the least-privilege required permissions are:

* "iam:GetUser",
* "iam:CreateUser",
* "iam:PutUserPolicy",
* "iam:CreateAccessKey",
* "kms:CreateKey",
* "kms:CreateAlias",
* "kms:DescribeKey",
* "kms:ScheduleKeyDeletion",
* "kms:DeleteAlias",
* "iam:DeleteUserPolicy",
* "iam:DeleteAccessKey",
* "iam:DeleteUser"

## Brand-New Installation
```
git clone https://github.com/nbailey20/HACC.git
cd HACC/
```
* Review/update configuration variables in Hacc/hacc.conf.template
* Rename hacc.conf.template -> hacc.conf
```
./MAC_LINUX_SETUP.sh
hacc --install
```
Done!

## Adding New Device to Existing Vault

### On A Device with Vault Configured
```
hacc --configure --export --file filename
```
* An encrypted_file called filename will be created in the current directory
* Save the encryption_password for exported configuration - the new device needs it in the next step!
* Send encrypted_file to new device

### On New Device
```
git clone https://github.com/nbailey20/HACC.git
cd HACC/
./MAC_LINUX_SETUP.sh (enter "existing")
hacc --configure --set all --file encrypted_file --password encryption_password
```

...and you're all set with your new Vault!



# Example Usage & Features

## Verifying Client Installation

### Testing client after brand new install
![No Vault detected](/usage_pics/test_client_install.jpg?raw=true)

### Help output
![No Vault detected](/usage_pics/help_output.jpg?raw=true)

### New Vault installation
![Vault install completed](/usage_pics/vault_install.jpg?raw=true)

### Empty Vault, ready for credentials
![Vault empty](/usage_pics/empty_vault.jpg?raw=true)


## Adding Credentials

### Adding new credential, one-line command with known password
![User added](/usage_pics/add_oneline_password.jpg?raw=true)

Note: --user and --password have short flags: -u and -p

### Adding new credential, interactive, known password
![User added](/usage_pics/add_interactive_password.jpg?raw=true)

Note: the --add action has a short flag: -a

### Adding new credential, interactive, generate password
![User added](/usage_pics/add_interactive_generate.jpg?raw=true)

Note: specify that you want a password generated by interactively saying yes, or with the --generate/-g flag


## Searching Credentials

### Searching credentials interactively
![Service credential listing](/usage_pics/search_interactive.jpg?raw=true)

Note: Service testService was selected above by interactively providing line number 1

Username Alice was selected by providing the value A, which acts as a filtering prefix, eliminating the need to type the whole value "Alice"

If multiple values match a provided prefix, further interactive input is needed to make a decision

### Retrieving credential for known service/username
![Service credential listing](/usage_pics/search_oneline.jpg?raw=true)

Note: service/username prefixes can be provided interactively or as CLI parameters, instead of typing out full values: 
```
hacc t -u bo
```
(assuming you have one service starting with "t" and one username belonging to said service that starts with "bo")



# Appendix
## Current features, replace with screenshots to demo usage
* Add new credential to vault with username/password for a service
* Store multiple credentials per service
* Provided arguments with flags or interactively
* Pagination for interactive input, search services/usernames by name prefix or line number
* Generate hard-to-guess password for new credentials offline via built-in wordlist
* Delete service and associated credentials from vault
* Return specific or all credentials for service by 'haccing' it
* Use existing AWS CLI credentials to create new least-privilege vault user and KMS CMK, saved credentials as new HACC profile
* Eradicate action to remove IAM, KMS resources and optionally all Vault credentials
* Fully wipe any sign of hacc AWS profile from local credentials/config files once Vault eradicated
* Error handling for install/eradicate and idempotency, other actions if Vault not setup
* Checks for existing services and usernames before adding/deleting credentials
* AWS Organization mode locks down operations on credential parameters to hacc-user so nobody else can read/delete by unintentionally - via optional SCP applied to member account containing Vault (requires adequate role in org to apply SCPs)
* Backup entire vault to file
* Ability to provide backup file for new vault install or add to existing vault, "--file" subarg
* Ability to rotate existing credentials
* Cleanly exit at any point with ctrl-c
* 'configure' keyword to set/show/export client configuration parameters
    * export config as encrypted file to grant multiple users access to single Vault
* Optionally check for client version updates in github, --upgrade keyword if not on latest version



## Creating executable file from Python source
```pyinstaller hacc```
* Will create dist\hacc folder, add this directory to PATH env variable
* Note: if rebuilding, first delete build and dist folders or errors may occur, and restart terminal after running command

## Future Needs
* Support for services with more than 4KB of credentials via multiple parameters per service
* Confirm user doesn't already exist for add action before asking for password if not provided
* Test that all required config variables for action are valid
* Set max password generation length for dumb sites --max-len
* --no-specials and --no-numbers for password generation
* Backup option --no-creds for usernames/services only
* -y option to automate interactive questions
* Support service/name prefixes properly for rotate action
* Support for different password types, e.g. base64, random, xkcd
* Add confirmation before installing vault, but show how many components are setup first
* Configuration bool to indicate whether previous HACC client versions should be cleaned up from system
* Reduce args passed to funcs to only necessary values
* Option for AWS-managed SSM KMS key for completely free Vault
* Add MIT license